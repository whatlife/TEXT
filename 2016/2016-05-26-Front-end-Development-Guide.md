# 前端资源整合优化方案 
## 最终目标
本方案目标是使得项目的目录结构清晰，开发流程优化，最终趋于前端工程化。
一般可以分为五个步骤
> （1） 初始，生成基础目录结构和样式库。
（2） 开发，实时预览、预编译。
（3） 构建，预编译、合并、压缩。
（4） 发布，将构建后静态文件发布上线。
（5） 打包，资源路径转换，源码打包。
 
针对项目实际情况，可以不用按照以上步骤来实施，但总体方向不变。

## 目前面临的问题
- 凌乱。
- 除了普通的外联样式以外，还出现的页面内内联，甚至是行内样式。太随意，导致jsp页面看起来很不清爽不干净
- 文件缩进没有统一，是4个空格？2个空格？还是一个tab？
- 样式无复用，重复性太高。
- 样式文件太多，基本每个文件里都有`css reset`，到处都是`层叠`！
- 资源目录文件没有规范。
- js文件重复太多，有的同样功能插件存在不同版本。
- js书写较随意，有些jsp页面里的实现功能性的脚本是可以外链加载。
- 维护起来非常困难。

## 拟实施计划，具体操作
### 1 修改静态资源目录。
原来的目录较乱，无法忍受下面这种目录结构。。。

所以第一步，重新定义一下CommonPath, StaticPath的定义，根据公共与静态的定义，放不同的资源文件。

例如：
Common可以放置如jquery，jquery-ui，uploadfile，99form.js 等库文件和插件脚本，和放置站点的公共的css如common.css等。
Static可以放置功能模块以及业务相关的脚本，比如school/xx.js，login/xx.js， user/xx.js等，以及相应的css文件。

现在看起来，static目录是比较符合我预期的目录结构，今后可能会以static目录为主，甚至可能将common目录取消掉，只保留static目录。即如下目录结构
```
static
  -css
  -js
    -lib
    -modules
  -images
```

这步先规划好目录，然后继续

### 2  删除
这第二步需要整理，删除多余的文件。删掉多余的，未用的，重复的插件。并将这些插件整理到对应的目录下。并去修改jsp页面中引用的路径

> 1，2两步可以结合起来，前后交叉进行

### 3 从减少网络带宽角度
- 小图片合并雪碧图
- JS，CSS文件选择性合并
- 避免重复的资源请求
- 压缩CSS、JS、图片
- 尽可能控制DOM节点数
- 精简CSS，JavaScript，移除注释，空格，重复css，js
- 服务端开启gzip压缩

### 4 代码角度考虑优化点
- JSP页面的代码优化
    避免空的图片src；
    避免不必要的内联样式；
    避免不必要的行内样式。

- CSS的代码优化
    统一的代码风格；
    建议使用类型选择器，访问速度快；
    不建议使用很长很长的base64；
    避免使用CSS表达式；
    避免使用Filters。
    
- JS的代码优化
    统一的代码风格；
    避免使用eval；
    减少作用域链查找；
    减少DOM访问，尽量缓存DOM；
    充分利用事件委托；
    减少Repaint（重绘）和Reflow（重排）最好通过批量更新元素减少重排次数。如设置类class统一更新样式，在添加多个li元素将会触发多次页面重排的情况下使用 DOM fargment 在内存中创建完整的 DOM 节点，然后再一次性添加到 DOM 中。

- 图片
    颜色较为丰富的图片而且文件比较大的（40KB - 200KB）或者有内容的图片优先考虑 jpg；图标等颜色比较简单、文件体积不大、起修饰作用的图片，优先考虑使用 PNG8 格式；图像颜色丰富而且图片文件不太大的（40KB 以下）或有半透明效果的优先考虑 PNG24 格式。
    条件允许的，使用新格式WEBP和BPG。
- 加载
    合理分配资源加载时间，按需加载，包括CSS，JavaScript以及图片，业务模块等。
- DNS
    减少DNS查询。`< link rel="dns-prefetch" href="" />`

## 其他


> Written with [StackEdit](https://stackedit.io/).